name: Pull Request Checks

# ============================================================================
# PULL REQUEST VALIDATION
# ============================================================================
# This workflow runs on every pull request to ensure quality standards
# Faster feedback loop than full CI/CD pipeline
# ============================================================================

on:
  pull_request:
    types: [opened, synchronize, reopened]

concurrency:
  group: pr-${{ github.event.pull_request.number }}
  cancel-in-progress: true

jobs:
  # Quick validation checks for faster feedback
  pr-validation:
    name: ðŸ” PR Quick Checks
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ðŸ“¥ Checkout PR
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - name: ðŸ Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: ðŸ”§ Install dependencies
        run: |
          pip install black isort flake8
          pip install -r requirements.txt

      - name: ðŸŽ¨ Check code formatting
        run: |
          echo "Checking Black formatting..."
          black --check short_term_mcp/ || {
            echo "âŒ Code formatting issues found"
            echo "ðŸ’¡ Run: black short_term_mcp/"
            exit 1
          }

      - name: ðŸ“‹ Check import sorting
        run: |
          echo "Checking isort..."
          isort --check-only short_term_mcp/ || {
            echo "âŒ Import sorting issues found"
            echo "ðŸ’¡ Run: isort short_term_mcp/"
            exit 1
          }

      - name: ðŸ”Ž Quick lint check
        run: |
          echo "Running flake8..."
          flake8 short_term_mcp/ --count --select=E9,F63,F7,F82 --show-source --statistics

      - name: ðŸ“Š PR validation summary
        if: success()
        run: |
          echo "# âœ… PR Validation Passed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "All quick checks passed! The full CI/CD pipeline will run next." >> $GITHUB_STEP_SUMMARY

      - name: ðŸ’¡ Auto-fix suggestions
        if: failure()
        run: |
          echo "# ðŸ”§ Auto-Fix Commands" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
          echo "# Fix formatting issues automatically" >> $GITHUB_STEP_SUMMARY
          echo "black short_term_mcp/" >> $GITHUB_STEP_SUMMARY
          echo "isort short_term_mcp/" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "# Then commit the changes" >> $GITHUB_STEP_SUMMARY
          echo "git add ." >> $GITHUB_STEP_SUMMARY
          echo "git commit -m \"style: auto-fix formatting\"" >> $GITHUB_STEP_SUMMARY
          echo "git push" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
